<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PLO ‚Äî Architecture & UJM</title>
  <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #f8fafc;
      color: #1e293b;
      line-height: 1.6;
    }

    /* ‚îÄ‚îÄ Header ‚îÄ‚îÄ */
    header {
      background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 100%);
      color: white;
      padding: 40px 60px;
      border-bottom: 4px solid #3b82f6;
    }
    header h1 { font-size: 28px; font-weight: 800; letter-spacing: -0.5px; }
    header p  { font-size: 15px; color: #94a3b8; margin-top: 6px; }
    .badge {
      display: inline-block;
      background: #3b82f6;
      color: white;
      font-size: 11px;
      font-weight: 700;
      padding: 2px 8px;
      border-radius: 20px;
      margin-left: 10px;
      vertical-align: middle;
      letter-spacing: 0.5px;
    }

    /* ‚îÄ‚îÄ Nav ‚îÄ‚îÄ */
    nav {
      position: sticky;
      top: 0;
      z-index: 100;
      background: white;
      border-bottom: 1px solid #e2e8f0;
      padding: 0 60px;
      display: flex;
      gap: 0;
    }
    nav a {
      display: block;
      padding: 14px 20px;
      font-size: 13px;
      font-weight: 600;
      color: #64748b;
      text-decoration: none;
      border-bottom: 3px solid transparent;
      transition: all 0.15s;
    }
    nav a:hover { color: #3b82f6; border-color: #93c5fd; }

    /* ‚îÄ‚îÄ Sections ‚îÄ‚îÄ */
    .section {
      padding: 60px;
      border-bottom: 1px solid #e2e8f0;
    }
    .section:nth-child(odd) { background: white; }
    .section:nth-child(even) { background: #f8fafc; }

    .section-header {
      display: flex;
      align-items: flex-start;
      gap: 20px;
      margin-bottom: 40px;
    }
    .section-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      flex-shrink: 0;
    }
    .icon-blue   { background: #dbeafe; }
    .icon-purple { background: #ede9fe; }
    .icon-green  { background: #dcfce7; }

    .section-header h2 {
      font-size: 22px;
      font-weight: 700;
      color: #0f172a;
    }
    .section-header p {
      font-size: 14px;
      color: #64748b;
      margin-top: 4px;
      max-width: 700px;
    }

    /* ‚îÄ‚îÄ Diagram container ‚îÄ‚îÄ */
    .diagram-card {
      background: white;
      border: 1px solid #e2e8f0;
      border-radius: 16px;
      padding: 32px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.06);
      overflow-x: auto;
    }

    .mermaid {
      text-align: center;
    }

    /* ‚îÄ‚îÄ UJM table ‚îÄ‚îÄ */
    .ujm-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
    }
    .ujm-table th {
      background: #0f172a;
      color: white;
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      white-space: nowrap;
    }
    .ujm-table td {
      padding: 12px 16px;
      border-bottom: 1px solid #e2e8f0;
      vertical-align: top;
    }
    .ujm-table tr:nth-child(even) td { background: #f8fafc; }
    .phase-header td {
      background: #1e3a5f !important;
      color: white;
      font-weight: 700;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }
    .emoji-score {
      font-size: 20px;
      display: block;
      margin-bottom: 2px;
    }
    .tag {
      display: inline-block;
      padding: 2px 8px;
      border-radius: 4px;
      font-size: 11px;
      font-weight: 600;
      margin: 2px;
    }
    .tag-red    { background: #fee2e2; color: #991b1b; }
    .tag-orange { background: #ffedd5; color: #9a3412; }
    .tag-blue   { background: #dbeafe; color: #1e40af; }
    .tag-green  { background: #dcfce7; color: #166534; }
    .tag-gray   { background: #f1f5f9; color: #475569; }

    .pain-point { color: #dc2626; font-size: 12px; }
    .opportunity { color: #16a34a; font-size: 12px; }
    .touchpoint { font-size: 12px; color: #3b82f6; font-style: italic; }

    /* ‚îÄ‚îÄ Legend ‚îÄ‚îÄ */
    .legend {
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      margin-top: 24px;
      padding: 16px 20px;
      background: #f8fafc;
      border-radius: 8px;
      border: 1px solid #e2e8f0;
    }
    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 12px;
      color: #475569;
    }
    .legend-dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* ‚îÄ‚îÄ Sprints tag ‚îÄ‚îÄ */
    .sprint-tags {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 12px;
    }
    .sprint-tag {
      font-size: 11px;
      font-weight: 700;
      padding: 3px 10px;
      border-radius: 20px;
      border: 1px solid;
    }
    .s1 { background: #f0fdf4; color: #15803d; border-color: #bbf7d0; }
    .s2 { background: #eff6ff; color: #1d4ed8; border-color: #bfdbfe; }
    .s3 { background: #fdf4ff; color: #7e22ce; border-color: #e9d5ff; }
    .s4 { background: #fff7ed; color: #c2410c; border-color: #fed7aa; }
    .s5 { background: #f0f9ff; color: #0369a1; border-color: #bae6fd; }

    footer {
      text-align: center;
      padding: 30px;
      font-size: 12px;
      color: #94a3b8;
      background: #0f172a;
      color: #64748b;
    }
  </style>
</head>
<body>

<header>
  <h1>PLO ‚Äî Project Lifecycle Orchestrator <span class="badge">v1.0 ¬∑ Sprints 1‚Äì5</span></h1>
  <p>Architecture technique ¬∑ Architecture fonctionnelle ¬∑ User Journey Map</p>
  <div class="sprint-tags" style="margin-top:14px;">
    <span class="sprint-tag s1">Sprint 1 ¬∑ Donn√©es</span>
    <span class="sprint-tag s2">Sprint 2 ¬∑ API Ingestion</span>
    <span class="sprint-tag s3">Sprint 3 ¬∑ Moteur anomalie</span>
    <span class="sprint-tag s4">Sprint 4 ¬∑ Interface</span>
    <span class="sprint-tag s5">Sprint 5 ¬∑ Adaptateurs</span>
  </div>
</header>

<nav>
  <a href="#tech">Architecture technique</a>
  <a href="#fonc">Architecture fonctionnelle</a>
  <a href="#ujm">User Journey Map</a>
</nav>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- 1. ARCHITECTURE TECHNIQUE                                       -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="section" id="tech">
  <div class="section-header">
    <div class="section-icon icon-blue">‚öôÔ∏è</div>
    <div>
      <h2>Architecture technique</h2>
      <p>Stack Node.js / TypeScript ‚Äî ingestion asynchrone via BullMQ, moteur d'anomalie hybride (temps r√©el + cron), interface React d√©coupl√©e.</p>
    </div>
  </div>

  <div class="diagram-card">
    <div class="mermaid">
flowchart TB
    subgraph SRC["üîå Sources externes"]
      direction LR
      ERP["ERP\ncommandes ¬∑ stock ¬∑ picking"]
      OMS["OMS\nshipments ¬∑ consolidation"]
      TMS["TMS Last Mile\nlivraison client"]
      WFM["WFM\ninstallation ¬∑ pose"]
      CRM["CRM\nqualit√© ¬∑ cl√¥ture"]
      ECOM["E-commerce\npanier ¬∑ paiement"]
    end

    subgraph API["üöÄ API Layer ‚Äî Fastify 5 ¬∑ Node 20+"]
      direction TB
      AUTH["Auth Plugin\nBearer token / source"]
      INGEST["POST /api/events/ingest\nZod validation"]
      ADAPTERS["Adapters\nERP ¬∑ OMS ¬∑ TMS ¬∑ WFM ¬∑ CRM ¬∑ Ecom ¬∑ Manual"]
      PUBLIC["Routes publiques\nGET /projects  GET /anomalies\nGET /rules  PATCH /rules/:id\nPOST /anomalies/:id/ack"]
    end

    subgraph ASYNC["‚öôÔ∏è Traitement asynchrone"]
      QUEUE["BullMQ Queue\nplo-events\n(Redis 7)"]
      DLQ["Dead Letter Queue\nplo-dead-letters"]
      WORKER["Worker BullMQ\n‚Ä¢ Step upsert\n‚Ä¢ Entity updates\n‚Ä¢ R√®gles temps r√©el"]
      CRON["node-cron\n‚Ä¢ Horaire  0 * * * *\n‚Ä¢ Quotidien 0 9 * * *\nR√®gles scheduled"]
    end

    subgraph DB["üóÑÔ∏è PostgreSQL 15 + Prisma 5"]
      MODELS["12 mod√®les\nProject ¬∑ Order ¬∑ OrderLine ¬∑ Shipment\nConsolidation ¬∑ LastMileDelivery\nInstallation ¬∑ Step ¬∑ Event\nAnomalyRule ¬∑ Notification\nProjectExternalRef"]
    end

    subgraph NOTIF["üì¨ Notifications"]
      EMAIL["nodemailer\nTemplates ANO-01/02/06\nfallback console"]
    end

    subgraph FRONT["üñ•Ô∏è Frontend ‚Äî React 18 + Vite 5"]
      UI["Interface op√©rateur\n‚Ä¢ Vue Projets\n‚Ä¢ Vue D√©tail + Timeline\n‚Ä¢ Vue Anomalies\n‚Ä¢ Vue R√®gles\nTailwind 3 ¬∑ React Query 5\nReact Router 6"]
    end

    SRC -->|Bearer token| AUTH
    AUTH --> INGEST
    INGEST --> ADAPTERS
    ADAPTERS -->|event cr√©√©| QUEUE
    ADAPTERS -->|projet inconnu| DLQ
    QUEUE --> WORKER
    WORKER -->|read/write| MODELS
    WORKER -->|alerte| EMAIL
    CRON -->|√©value r√®gles| MODELS
    CRON -->|alerte| EMAIL
    PUBLIC -->|read| MODELS
    UI <-->|React Query\nproxy /api| PUBLIC
    UI -->|POST ingest| AUTH
    </div>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#3b82f6"></div>Flux synchrone (HTTP)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#a855f7"></div>Flux asynchrone (queue)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#22c55e"></div>Lecture/√©criture base</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f59e0b"></div>Notifications sortantes</div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- 2. ARCHITECTURE FONCTIONNELLE                                   -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="section" id="fonc">
  <div class="section-header">
    <div class="section-icon icon-purple">üîÑ</div>
    <div>
      <h2>Architecture fonctionnelle</h2>
      <p>Cycle de vie complet d'un projet client ‚Äî des √©tapes amont (inspiration, devis) jusqu'√† la cl√¥ture, avec les 22 r√®gles d'anomalie d√©clench√©es √† chaque niveau.</p>
    </div>
  </div>

  <div class="diagram-card">
    <div class="mermaid">
flowchart LR
    subgraph P["üìÅ NIVEAU PROJECT"]
      direction TB
      P1["Inspiration\n‚ú¶ inspiration.started\n‚ú¶ inspiration.completed\n‚ú¶ inspiration.converted"]
      P2["Devis Produits\n‚ú¶ quote_products.created\n‚ú¶ quote_products.accepted\n‚ú¶ quote_products.expired"]
      P3["Devis Pose\n‚ú¶ quote_installation.created\n‚ú¶ quote_installation.accepted"]
      P6["Consolidation\n‚ú¶ consolidation.order_arrived\n‚ú¶ consolidation.complete\n‚ú¶ consolidation.exception"]
      P7["Last Mile\n‚ú¶ lastmile.scheduled\n‚ú¶ lastmile.delivered\n‚ú¶ lastmile.failed"]
      P8["Cl√¥ture\n‚ú¶ project.closed\n‚ú¶ quality.survey_completed"]
    end

    subgraph O["üì¶ NIVEAU ORDER √ó N commandes"]
      direction TB
      O1["Commande\n‚ú¶ order.confirmed\n‚ú¶ order.cancelled"]
      O2["Stock\n‚ú¶ stock.check_ok\n‚ú¶ stock.shortage"]
      O3["Picking\n‚ú¶ picking.started\n‚ú¶ picking.completed\n‚ú¶ picking.discrepancy"]
      O4["Exp√©dition\n‚ú¶ shipment.dispatched\n‚ú¶ shipment.eta_updated\n‚ú¶ shipment.arrived_at_station"]
    end

    subgraph I["üîß NIVEAU INSTALLATION"]
      direction TB
      I1["Planification\n‚ú¶ installation.scheduled\n‚ú¶ installation.rescheduled"]
      I2["Intervention\n‚ú¶ installation.started\n‚ú¶ installation.completed\n‚ú¶ installation.issue"]
      I3["R√©ception\n‚ú¶ customer_signature.signed\n‚ú¶ installation.report_submitted"]
    end

    subgraph ANO["üö® MOTEUR ANOMALIE ‚Äî 22 r√®gles"]
      direction TB
      RT["‚ö° Temps r√©el\nANO-01 Stock tardif\nANO-02 √âcart picking\nANO-05 Install sans livraison\nANO-06 Probl√®me installation\nANO-11 Install sans pr√©requis\nANO-12 Incident bloquant\nANO-15 Refus signature\nANO-16 ETA d√©passe date promise\nANO-18 Exception station\nANO-19 Last mile sans conso\nANO-20 Partiel sans accord\nANO-22 Last mile √©chou√©"]
      HR["‚è∞ Cron horaire\nANO-08 Picking non d√©marr√©\nANO-09 Livraison sans cl√¥ture\nANO-13 Technicien en retard\nANO-14 CR non soumis\nANO-21 Silence OMS 24h"]
      DA["üìÖ Cron quotidien\nANO-04 Livraison partielle pr√©-pose\nANO-07 Livraison non planifi√©e\nANO-10 Devis pose non cr√©√©\nANO-17 Consolidation incompl√®te J-3"]
    end

    subgraph OUT["üì¨ SORTIES"]
      N1["Email coordinateur"]
      N2["Email acheteur"]
      N3["Email manager"]
      N4["Email ops"]
      N5["Interface PLO\nbadge rouge / orange"]
    end

    P1 --> P2 --> P3 --> O1
    O1 --> O2 --> O3 --> O4 --> P6 --> P7
    P7 --> I1 --> I2 --> I3 --> P8

    O2 -->|stock.shortage| RT
    O3 -->|picking.discrepancy| RT
    O4 -->|shipment.eta_updated| RT
    P6 -->|consolidation.exception| RT
    P7 -->|lastmile.scheduled| RT
    I2 -->|installation.issue| RT
    I3 -->|signed=false| RT

    O3 -.->|H-8| HR
    P7 -.->|H+4| HR
    I2 -.->|H+2| HR
    O4 -.->|24h silence| HR
    P6 -.->|J-3| DA
    P3 -.->|H+48| DA

    RT --> N1 & N2 & N3
    HR --> N1 & N4
    DA --> N1
    RT & HR & DA --> N5
    </div>
  </div>

  <div class="legend">
    <div class="legend-item"><div class="legend-dot" style="background:#374151"></div>Flux principal cycle de vie</div>
    <div class="legend-item"><div class="legend-dot" style="background:#ef4444"></div>D√©clencheur temps r√©el (event)</div>
    <div class="legend-item"><div class="legend-dot" style="background:#6b7280;border:2px dashed #9ca3af;width:20px;height:3px;border-radius:0"></div>D√©clencheur cron (d√©lai)</div>
  </div>
</section>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<!-- 3. USER JOURNEY MAP                                             -->
<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<section class="section" id="ujm">
  <div class="section-header">
    <div class="section-icon icon-green">üó∫Ô∏è</div>
    <div>
      <h2>User Journey Map</h2>
      <p>
        Persona : <strong>Coordinateur op√©rationnel</strong> ‚Äî Sc√©nario : d√©tection et r√©solution d'une anomalie critique
        <em>ANO-16 (ETA Shipment d√©passe la date de livraison promise client)</em>.
      </p>
    </div>
  </div>

  <!-- Mermaid journey -->
  <div class="diagram-card" style="margin-bottom:32px;">
    <div class="mermaid">
journey
    title Coordinateur ‚Äî Gestion anomalie critique PLO (ANO-16)
    section D√©tection
      R√©ception email alerte: 2: Coordinateur
      Connexion interface PLO: 4: Coordinateur
    section Investigation
      Vue anomalies actives: 5: Coordinateur
      Clic sur projet Dubois: 5: Coordinateur
      Consultation timeline: 4: Coordinateur
      Analyse ETA vs date promise: 2: Coordinateur
    section Action
      Contact transporteur hors PLO: 3: Coordinateur
      Saisie √©v√©nement manuel PLO: 4: Coordinateur
      Communication client: 2: Coordinateur, Manager
    section R√©solution
      Acquittement anomalie: 5: Coordinateur
      R√©ception M√†J OMS: 4: Coordinateur
      Livraison confirm√©e: 5: Coordinateur, Manager
    </div>
  </div>

  <!-- Detailed UJM table -->
  <div class="diagram-card" style="overflow-x:auto;">
    <table class="ujm-table">
      <thead>
        <tr>
          <th style="width:90px">Phase</th>
          <th style="width:130px">√âtape</th>
          <th style="width:110px">Acteur(s)</th>
          <th style="width:120px">Action</th>
          <th style="width:120px">Outil / Touchpoint</th>
          <th style="width:90px">√âmotion</th>
          <th>Pain points üî¥</th>
          <th>Opportunit√©s ‚úÖ</th>
        </tr>
      </thead>
      <tbody>

        <!-- PHASE 1 -->
        <tr class="phase-header">
          <td colspan="8">üì° PHASE 1 ‚Äî D√âTECTION</td>
        </tr>
        <tr>
          <td rowspan="2"><span class="tag tag-red">D√©tection</span></td>
          <td>R√©ception alerte</td>
          <td>Coordinateur</td>
          <td>Ouvre email d'alerte ANO-16 re√ßu √† 9h</td>
          <td><span class="touchpoint">üìß Email PLO</span></td>
          <td><span class="emoji-score">üòü</span>Inquiet</td>
          <td class="pain-point">Email perdu dans la bo√Æte si volume √©lev√©. Pas de prioritisation.</td>
          <td class="opportunity">Objet email structur√© avec s√©v√©rit√© + client. Badge in-app visible au login.</td>
        </tr>
        <tr>
          <td>Connexion PLO</td>
          <td>Coordinateur</td>
          <td>Ouvre l'interface op√©rateur</td>
          <td><span class="touchpoint">üñ•Ô∏è Interface PLO</span></td>
          <td><span class="emoji-score">üòê</span>Neutre</td>
          <td class="pain-point">Pas de notification push navigateur. Doit aller checker activement.</td>
          <td class="opportunity">Badge rouge sur l'ic√¥ne onglet. Notification push web (Sprint 6).</td>
        </tr>

        <!-- PHASE 2 -->
        <tr class="phase-header">
          <td colspan="8">üîç PHASE 2 ‚Äî INVESTIGATION</td>
        </tr>
        <tr>
          <td rowspan="3"><span class="tag tag-orange">Investigation</span></td>
          <td>Vue anomalies actives</td>
          <td>Coordinateur</td>
          <td>Consulte la liste tri√©e par s√©v√©rit√©</td>
          <td><span class="touchpoint">üñ•Ô∏è /anomalies</span></td>
          <td><span class="emoji-score">üßê</span>Concentr√©</td>
          <td class="pain-point">Si beaucoup d'anomalies : difficile de prioriser sans filtres avanc√©s.</td>
          <td class="opportunity">Filtres par type de projet, magasin, date. Vue group√©e par projet.</td>
        </tr>
        <tr>
          <td>Consultation timeline</td>
          <td>Coordinateur</td>
          <td>Clique sur le projet Dubois, lit la timeline</td>
          <td><span class="touchpoint">üñ•Ô∏è /projects/:id</span></td>
          <td><span class="emoji-score">üßê</span>Concentr√©</td>
          <td class="pain-point">Les events sont list√©s mais le contexte (pourquoi ce retard ?) n'est pas imm√©diatement lisible.</td>
          <td class="opportunity">Afficher l'ETA vs date promise en rouge directement sur la step. Lien vers suivi transporteur.</td>
        </tr>
        <tr>
          <td>Analyse ETA</td>
          <td>Coordinateur</td>
          <td>Rep√®re l'√©cart ETA / date promise dans le payload</td>
          <td><span class="touchpoint">üñ•Ô∏è PLO Timeline</span></td>
          <td><span class="emoji-score">üò∞</span>Inquiet</td>
          <td class="pain-point">L'ETA et la date promise sont dans des champs JSON bruts. Pas de calcul d'√©cart affich√©.</td>
          <td class="opportunity">Calculer et afficher l'√©cart en jours : "ETA dans 8j / promis dans 5j ‚Üí retard +3j".</td>
        </tr>

        <!-- PHASE 3 -->
        <tr class="phase-header">
          <td colspan="8">‚ö° PHASE 3 ‚Äî ACTION</td>
        </tr>
        <tr>
          <td rowspan="3"><span class="tag tag-blue">Action</span></td>
          <td>Contact transporteur</td>
          <td>Coordinateur</td>
          <td>Appelle / maile le transporteur hors PLO pour obtenir une ETA fiable</td>
          <td><span class="touchpoint">üìû T√©l√©phone / Email ext.</span></td>
          <td><span class="emoji-score">üò§</span>Frustr√©</td>
          <td class="pain-point">Sortie du PLO obligatoire. Pas de lien direct vers le tracking transporteur. Perte de contexte.</td>
          <td class="opportunity">Ajouter carrier_tracking_ref cliquable sur la step shipment. Lien direct suivi transporteur.</td>
        </tr>
        <tr>
          <td>Saisie manuelle</td>
          <td>Coordinateur</td>
          <td>Enregistre le contact via la modal "Saisie manuelle"</td>
          <td><span class="touchpoint">üñ•Ô∏è ManualEventModal</span></td>
          <td><span class="emoji-score">üòå</span>Soulag√©</td>
          <td class="pain-point">Doit conna√Ætre le bon event_type √† saisir. Pas de templates pr√©remplis par contexte.</td>
          <td class="opportunity">Sugg√©rer les event_types contextuels selon la step en cours. Champ commentaire libre.</td>
        </tr>
        <tr>
          <td>Communication client</td>
          <td>Coordinateur + Manager</td>
          <td>Informe le client du retard (appel ou email)</td>
          <td><span class="touchpoint">üìû CRM ext. / T√©l√©phone</span></td>
          <td><span class="emoji-score">üò∞</span>Stress√©</td>
          <td class="pain-point">Pas d'historique des contacts client dans le PLO. Duplication avec le CRM externe.</td>
          <td class="opportunity">Int√©gration CRM Sprint 5 : log automatique du contact. Proposition de nouvelle date depuis le PLO.</td>
        </tr>

        <!-- PHASE 4 -->
        <tr class="phase-header">
          <td colspan="8">‚úÖ PHASE 4 ‚Äî R√âSOLUTION</td>
        </tr>
        <tr>
          <td rowspan="3"><span class="tag tag-green">R√©solution</span></td>
          <td>Acquittement anomalie</td>
          <td>Coordinateur</td>
          <td>Clique "Acquitter", saisit son nom + commentaire</td>
          <td><span class="touchpoint">üñ•Ô∏è /anomalies</span></td>
          <td><span class="emoji-score">üòå</span>Soulag√©</td>
          <td class="pain-point">L'acquittement ne cl√¥ture pas la r√®gle si le probl√®me persiste : risque de re-d√©clenchement sans contexte.</td>
          <td class="opportunity">Ajouter un champ "action prise" + statut "en traitement" distinct de "r√©solu".</td>
        </tr>
        <tr>
          <td>R√©ception M√†J OMS</td>
          <td>Coordinateur</td>
          <td>Re√ßoit le nouvel event shipment.eta_updated pouss√© par l'OMS</td>
          <td><span class="touchpoint">‚öôÔ∏è API Ingest OMS</span></td>
          <td><span class="emoji-score">üëÄ</span>Vigilant</td>
          <td class="pain-point">Si la nouvelle ETA d√©passe encore la date promise : nouvelle anomalie ANO-16 relanc√©e sans lien avec la premi√®re.</td>
          <td class="opportunity">Historiser les d√©clenchements d'une m√™me r√®gle sur un projet. Vue "historique anomalies par projet".</td>
        </tr>
        <tr>
          <td>Livraison confirm√©e</td>
          <td>Coordinateur + Manager</td>
          <td>Re√ßoit event lastmile.delivered. Anomalie auto-r√©solue.</td>
          <td><span class="touchpoint">üñ•Ô∏è PLO + üìß Email</span></td>
          <td><span class="emoji-score">üòä</span>Satisfait</td>
          <td class="pain-point">Pas de notification automatique "anomalie r√©solue" ‚Äî doit checker manuellement.</td>
          <td class="opportunity">Notification de r√©solution automatique quand la condition d'anomalie n'est plus v√©rifi√©e.</td>
        </tr>

      </tbody>
    </table>
  </div>

  <!-- Synth√®se pain points / opportunit√©s -->
  <div style="margin-top:32px; display:grid; grid-template-columns:1fr 1fr; gap:24px;">
    <div style="background:white;border:1px solid #fecaca;border-radius:12px;padding:24px;">
      <h3 style="color:#dc2626;font-size:15px;margin-bottom:16px;">üî¥ Pain points prioritaires</h3>
      <ul style="list-style:none;space-y:8px;font-size:13px;color:#374151;line-height:2;">
        <li>1. Pas de calcul d'√©cart ETA vs date promise affich√©</li>
        <li>2. Lien tracking transporteur absent de la timeline</li>
        <li>3. Pas de notification push navigateur</li>
        <li>4. Sortie du PLO obligatoire pour contacter le transporteur</li>
        <li>5. Pas d'historique des contacts client</li>
        <li>6. Pas de notification de r√©solution automatique</li>
      </ul>
    </div>
    <div style="background:white;border:1px solid #bbf7d0;border-radius:12px;padding:24px;">
      <h3 style="color:#16a34a;font-size:15px;margin-bottom:16px;">‚úÖ Opportunit√©s Sprint 6+</h3>
      <ul style="list-style:none;font-size:13px;color:#374151;line-height:2;">
        <li>1. Afficher l'√©cart ETA/promis en jours sur la step</li>
        <li>2. Lien cliquable carrier_tracking_ref</li>
        <li>3. Notification push web (Service Worker)</li>
        <li>4. Statut anomalie "en traitement" + historique</li>
        <li>5. Notification de r√©solution automatique</li>
        <li>6. Dashboard KPIs : MTTD, MTTR, taux anomalies / projet</li>
      </ul>
    </div>
  </div>
</section>

<footer>
  PLO ‚Äî Project Lifecycle Orchestrator ¬∑ Retailer bricolage omnicanal ¬∑ v1.0 ¬∑ Sprints 1‚Äì5
</footer>

<script>
  mermaid.initialize({
    startOnLoad: true,
    theme: 'default',
    flowchart: { curve: 'basis', padding: 20 },
    journey: { taskFontSize: 13 },
    themeVariables: {
      primaryColor: '#dbeafe',
      primaryTextColor: '#1e3a5f',
      primaryBorderColor: '#3b82f6',
      lineColor: '#94a3b8',
      secondaryColor: '#f0fdf4',
      tertiaryColor: '#fdf4ff',
      fontFamily: '-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',
    }
  });
</script>
</body>
</html>
